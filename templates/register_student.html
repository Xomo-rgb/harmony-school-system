<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Student Registration</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center px-4 py-8">
<div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-3xl">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold text-gray-800">Student Registration Form</h2>
<a href="{{ url_for('student.view_students') }}" class="text-sm font-medium text-gray-600 hover:text-green-600">&larr; Back to Student List</a>
</div>
<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mb-4 space-y-2">
      {% for category, message in messages %}
        <div class="p-3 rounded-md text-sm
                   {% if category == 'error' %} bg-red-100 text-red-800 border border-red-200 {% endif %}
                   {% if category == 'success' %} bg-green-100 text-green-800 border border-green-200 {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<form method="POST" action="{{ url_for('student.register_student') }}" class="space-y-6">
  <!-- We pass request.form back as form_data on validation error to repopulate fields -->
  {% set form_data = form_data or {} %}
  
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label for="first_name" class="block text-sm font-medium text-gray-700">First Name *</label>
      <input type="text" id="first_name" name="first_name" required value="{{ form_data.first_name or '' }}"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
    </div>
    <div>
      <label for="middle_name" class="block text-sm font-medium text-gray-700">Middle Name</label>
      <input type="text" id="middle_name" name="middle_name" value="{{ form_data.middle_name or '' }}"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
    </div>
    <div>
      <label for="last_name" class="block text-sm font-medium text-gray-700">Last Name *</label>
      <input type="text" id="last_name" name="last_name" required value="{{ form_data.last_name or '' }}"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label for="dob" class="block text-sm font-medium text-gray-700">Date of Birth *</label>
      <input type="date" id="dob" name="dob" required value="{{ form_data.dob or '' }}"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2" />
    </div>
    <div>
      <label for="gender" class="block text-sm font-medium text-gray-700">Gender *</label>
      <select id="gender" name="gender" required
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 bg-white">
        <option value="" {% if not form_data.gender %}selected{% endif %}>-- Select --</option>
        <option value="female" {% if form_data.gender == 'female' %}selected{% endif %}>Female</option>
        <option value="male" {% if form_data.gender == 'male' %}selected{% endif %}>Male</option>
      </select>
    </div>
    <div>
      <label for="class_name" class="block text-sm font-medium text-gray-700">Class *</label>
      <select id="class_name" name="class_name" required
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 bg-white">
        <option value="" {% if not form_data.class_name %}selected{% endif %}>-- Select --</option>
        <option value="nursery" {% if form_data.class_name == 'nursery' %}selected{% endif %}>Nursery</option>
        <option value="reception" {% if form_data.class_name == 'reception' %}selected{% endif %}>Reception</option>
        <option value="standard 1" {% if form_data.class_name == 'standard 1' %}selected{% endif %}>Standard 1</option>
        <option value="standard 2" {% if form_data.class_name == 'standard 2' %}selected{% endif %}>Standard 2</option>
        <option value="standard 3" {% if form_data.class_name == 'standard 3' %}selected{% endif %}>Standard 3</option>
        <option value="standard 4" {% if form_data.class_name == 'standard 4' %}selected{% endif %}>Standard 4</option>
        <option value="standard 5" {% if form_data.class_name == 'standard 5' %}selected{% endif %}>Standard 5</option>
        <option value="standard 6" {% if form_data.class_name == 'standard 6' %}selected{% endif %}>Standard 6</option>
      </select>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label for="guardian_contact" class="block text-sm font-medium text-gray-700">Guardian's Phone *</label>
      <input type="tel" id="guardian_contact" name="guardian_contact" required value="{{ form_data.guardian_contact or '' }}"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2" />
    </div>
    <div>
      <label for="government_number" class="block text-sm font-medium text-gray-700">Government Number</label>
      <input type="text" id="government_number" name="government_number" value="{{ form_data.government_number or '' }}"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2" />
    </div>
  </div>

  <div>
    <label for="special_needs" class="block text-sm font-medium text-gray-700">Special Needs / Medical Info</label>
    <textarea id="special_needs" name="special_needs" rows="3"
      class="mt-1 block w-full rounded border border-gray-300 px-3 py-2"
      placeholder="e.g., Allergies, medical conditions, etc.">{{ form_data.special_needs or '' }}</textarea>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label for="address" class="block text-sm font-medium text-gray-700">Address *</label>
      <input type="text" id="address" name="address" required value="{{ form_data.address or '' }}"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2" />
    </div>
    <div>
      <label for="enrollment_date" class="block text-sm font-medium text-gray-700">Enrollment Date *</label>
      <input type="date" id="enrollment_date" name="enrollment_date" required value="{{ form_data.enrollment_date or '' }}"
        class="mt-1 block w-full rounded border border-gray-300 px-3 py-2" />
    </div>
  </div>

  <div class="text-center pt-4">
    <button type="submit"
      class="bg-green-600 text-white px-8 py-2 rounded-md hover:bg-green-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
      Register Student
    </button>
  </div>
</form>
</div>
</body>
</html>